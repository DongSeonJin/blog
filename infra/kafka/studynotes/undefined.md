# 내부 메커니즘





## 클러스터 멤버십

> 카프카 클러스터 멤버십은 여러 브로커(서버)가 서로를 인식하고, 장애를 감지하며, 리더 역할을 하는 컨트롤러를 선출하여 하나의 시스템처럼 동작하게 만드는 메커-니즘이다. 이를 통해 일부 브로커에 장애가 생겨도 클러스터 전체는 안정적으로 유지될 수 있다.



**과거 카프카는 클러스터 멤버십 관리를 외부 시스템인 주키퍼에 전적으로 의존했다. 최신 카프카는 주키퍼 의존성을 제거하고, 자체적인 합의 프로토콜인 KRaft(Kafka Raft Metadata mode)를 사용한다.**

* 멤버 등록 및 감지: 클러스터 내의 컨트롤러 역할을 하는 노드들이 Raft 쿼럼(Quorum, 정족수)을 형성한다. 나머지 브로커들은 이 쿼럼의 리더(활성 컨트롤러)와 직접 통신하며 하트비트를 보낸다. 하트비트가 일정 시간 끊기면 해당 브로커는 클러스터에서 제외된 것으로 간주한다.
* 컨트롤러 선출: 컨트롤러 역할을 하는 노드들 사이에서 Raft 프로토콜에 따라 자체적으로 리더를 선출한다. 이 방식은 주키퍼를 사용할 때보다 훨씬 빠르고 안정적이다. 모든 클러스터 메타데이터는 주키퍼가 아닌, 내부 토픽에 저장 및 복제된다.

























