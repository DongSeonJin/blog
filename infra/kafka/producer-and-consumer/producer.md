---
description: 카프카 프로듀서
---

# Producer



## 카프카에 메시지를 쓰는 과정&#x20;

> 카프카에 메시지를 쓰는 작업은 ProducerRecord 객체를 생성함으로써 시작된다.&#x20;
>
> '토픽'과 '밸류' 지정은 필수, '키'와 '파티션' 지정은 선택사항

{% stepper %}
{% step %}
### 시리얼라이저

메시지의 키와 값을 네트워크로 보낼 수 있도록 바이트 배열로 변환한다.
{% endstep %}

{% step %}
### 파티셔너

메시지 키의 해시값 등을 이용해 어떤 파티션으로 보낼지 결정한다.
{% endstep %}

{% step %}
### 레코드 배치

파티션이 결정되면 메시지를 바로 보내지 않고, 레코드들을 모은 레코드 배치에 추가 한다.
{% endstep %}

{% step %}
### 전송

별도의 스레드가 배치로 묶인 메시지를 브로커로 전송한다.
{% endstep %}

{% step %}
### 실패 및 재시도

전송이 실패하면, 설정된 횟수만큼 자동으로 재시도를 한다.
{% endstep %}

{% step %}
### 브로커 저장 및 응답

전송에 성공하면 브로커는 해당 토픽의 파티션에 메시지를 저장하고, 성공했다는 응답을 프로듀서에게 보낸다.
{% endstep %}
{% endstepper %}





## 프로듀서 설정

* `max.block.ms`: `send()`를 호출했을 때 프로듀서의 전송 버퍼가 가득 차거나 메타데이터가 아직 사용 가능하지 않을 때 블록된다. 이 상태에서 `max.block.ms`만큼 시간이 흐르면 예외가 발생한다.
* `delivery.timeout.ms`: 프로듀서가 `send()`를 호출한 시점부터 브로커로부터 최종 성공 응답(Ack)을 받기까지 허용되는 전체 시간이다. 전송 시도, 재시도를 포함한 모든 과정의 총괄 타임아웃이다.
* `linger.ms`: 레코드가 전송될 배치를 형성하기 위해 프로듀서 내부 버퍼에서 대기하는 최대 시간이다.
* `request.timeout.ms`: 프로듀서가 브로커에게 단일 요청을 보낸 후 응답을 기다리는 최대 시간이다. 이 시간이 지나면 해당 요청은 실패로 간주하고 재시도를 수행한다.

#### _d**elivery.timeout.ms 는 linger.ms와 request.timeout.ms 보다 커야한다**_

* 부등식 표현

```
delivery.timeout.ms >= linger.ms + retry.backoff.ms + request.timeout.ms
```

메시지 전송이 성공하기 위한 최소 시간은 '버퍼 대기 시간(`linger.ms`)'과 최소 '한 번의 네트워크 요청 시간(`request.timeout.ms`)'의 합이다. `delivery.timeout.ms`는 이 전체 과정을 포괄하는 상위 개념의 타임아웃이다.





## 카프카 에이브로(Avro)





&#x20; &#x20;







